# Story 9.1c: Admin Portal BFF Endpoints

**As a** platform admin frontend,
**I want** REST API endpoints for all admin portal entity management,
**So that** Stories 9.2-9.5 can consume stable, tested APIs without building infrastructure.

## Endpoints Overview

This story creates all `/api/admin/*` BFF endpoints required by Epic 9 UI stories.

| Entity | Endpoints | Consumers |
|--------|-----------|-----------|
| **Region** | `GET/POST /api/admin/regions`, `GET/PUT /api/admin/regions/:id` | Story 9.2 |
| **Factory** | `GET/POST /api/admin/factories`, `GET/PUT /api/admin/factories/:id` | Story 9.3 |
| **Collection Point** | `GET/PUT /api/admin/collection-points/:id` | Story 9.4 |
| **Farmer** | `GET/POST /api/admin/farmers`, `GET/PUT /api/admin/farmers/:id`, `POST /api/admin/farmers/import` | Story 9.5 |

## Technical Context

- **Pattern**: Follow ADR-012 BFF Service Composition patterns
- **Composition**: Use `BaseService._parallel_map()` for fan-out scenarios
- **Schemas**: Create API schemas in `api/schemas/admin/` separate from domain models
- **Transformers**: Create transformers in `transformers/admin/` for domain-to-API mapping
- **Response Wrappers**: Use `PaginatedResponse[T]` for list endpoints

## E2E Testing Requirements

This story MUST include E2E tests validating the complete data flow:

```text
BFF REST API → gRPC Clients → Backend Services (Plantation) → MongoDB
```

### E2E Test Scenarios

| Scenario               | Flow                                       | Validates                                  |
| ---------------------- | ------------------------------------------ | ------------------------------------------ |
| **Region CRUD**        | Create → Get → Update → List               | Region endpoints + gRPC composition        |
| **Factory CRUD**       | Create → Get → Update → List               | Factory endpoints + gRPC composition       |
| **Collection Point**   | Get → Update (via factory)                 | CP endpoints + parent-child relationship   |
| **Farmer CRUD**        | Create → Get → Update → List with filters  | Farmer endpoints + filter composition      |
| **Farmer Import**      | CSV upload → Validation → Bulk create      | Import endpoint + batch processing         |

### Test Infrastructure

- **Seed Data**: Add admin entities to `tests/e2e/seed-data/` (regions, factories, CPs, farmers)
- **Scenarios**: Create `tests/e2e/scenarios/test_admin_api_*.py`
- **Validation**: Verify responses match BFF API schemas (not just HTTP 200)
- **Mental Model**: Follow `tests/e2e/E2E-TESTING-MENTAL-MODEL.md` - proto is source of truth

### Why E2E for an API Story?

Per our architecture discussion: this story creates the **integration layer** between BFF and backend services. E2E tests catch:

- gRPC client composition bugs
- Service-to-service communication issues
- Data transformation errors between layers
- Authorization/filtering logic gaps

Without E2E validation, Stories 9.2-9.5 would discover these bugs during UI development - causing costly rework.

## Dependencies

- Story 9.1b: Shared Admin UI Components (parallel, not blocking)
- ADR-012: BFF Service Composition and API Design Patterns
- ADR-015: E2E Autonomous Debugging Infrastructure
- Plantation Service gRPC: `ListRegions`, `CreateRegion`, `UpdateRegion`, `GetRegion`, `ListFactories`, `CreateFactory`, etc.

## Story Points: 8

---

> **Note:** Full acceptance criteria, tasks, and subtasks to be generated by `/create-story` workflow.
