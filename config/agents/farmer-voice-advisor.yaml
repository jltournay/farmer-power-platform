# Farmer Voice Advisor - Conversational Agent Configuration
# Story 0.75.21: Conversational Agent Implementation - Sample Config & Golden Tests
#
# This agent provides personalized voice-based agricultural advisory through
# multi-turn dialogue. It uses two LLM models:
#   - Fast model (Haiku) for intent classification
#   - Capable model (Sonnet) for response generation
#
# Features:
#   - Multi-turn conversation with context management
#   - RAG-enhanced responses with agricultural knowledge
#   - Session state persistence via MongoDB
#   - Sliding window context (last 3 turns)

id: "farmer-voice-advisor:1.0.0"
agent_id: "farmer-voice-advisor"
version: "1.0.0"
type: "conversational"
status: "active"
description: "Voice-based agricultural advisor for Kenyan smallholder farmers. Provides personalized guidance on tea cultivation, pest management, and best practices through natural multi-turn dialogue."

# Input contract - triggered by voice/WhatsApp message
input:
  event: "ai.agent.requested"
  schema:
    type: "object"
    required:
      - "session_id"
      - "user_message"
    properties:
      session_id:
        type: "string"
        description: "Unique conversation session identifier"
      user_message:
        type: "string"
        description: "User's voice/text message"
      farmer_id:
        type: "string"
        description: "Farmer's unique identifier (optional for context)"
      language:
        type: "string"
        enum: ["en", "sw"]
        default: "en"
        description: "Preferred language (English or Swahili)"

# Output contract - response for voice synthesis or text
output:
  event: "ai.agent.farmer-voice-advisor.completed"
  schema:
    type: "object"
    required:
      - "response"
      - "session_id"
    properties:
      response:
        type: "string"
        description: "Natural language response for the farmer"
      session_id:
        type: "string"
        description: "Session identifier for continuity"
      turn_count:
        type: "integer"
        description: "Current turn number in conversation"
      session_ended:
        type: "boolean"
        description: "Whether the conversation session ended"

# Primary LLM config (used for response generation)
llm:
  model: "anthropic/claude-3-5-sonnet"
  temperature: 0.4
  max_tokens: 500

# Two-model approach for Conversational agents
intent_model: "anthropic/claude-3-haiku"
response_model: "anthropic/claude-3-5-sonnet"

# RAG configuration for knowledge retrieval
rag:
  enabled: true
  query_template: "agricultural advice for tea farmers: {{user_message}} topic: {{intent}}"
  knowledge_domains:
    - "tea-cultivation"
    - "pest-management"
    - "seasonal-practices"
    - "common-questions"
  top_k: 3
  min_similarity: 0.65

# Conversation state management
state:
  max_turns: 5
  session_ttl_minutes: 30
  checkpoint_backend: "mongodb"
  context_window: 3

# MCP sources for farmer context enrichment
mcp_sources:
  - server: "plantation-mcp"
    tools:
      - "get_farmer"
      - "get_region"

# Error handling configuration
error_handling:
  max_attempts: 2
  backoff_ms:
    - 100
    - 500
  on_failure: "graceful_fallback"

# Metadata for tracking
metadata:
  author: "dev-story-0.75.21"
  changelog: "Initial version - voice advisor for tea farmers"
