# Disease Diagnosis Explorer Agent Configuration
# Story 0.75.19: Explorer Agent Implementation
#
# This agent analyzes quality issues and diagnoses tea plant diseases.
# Uses RAG for expert knowledge retrieval from tea-disease and plant-pathology domains.
#
# See: _bmad-output/architecture/ai-model-architecture/agent-types.md @ Explorer Type
# Reference: ExplorerConfig in services/ai-model/src/ai_model/domain/agent_config.py:359-393

id: "disease-diagnosis:1.0.0"
agent_id: "disease-diagnosis"
version: "1.0.0"
type: explorer
status: active
description: "Diagnoses tea plant diseases from quality events and farmer context using RAG knowledge"

# Input contract
input:
  event: "ai.agent.requested"
  schema:
    type: object
    required:
      - farmer_id
      - quality_issues
    properties:
      farmer_id:
        type: string
        description: "Farmer identifier (e.g., 'WM-4521')"
      doc_id:
        type: string
        description: "Collection document ID for source traceability"
      quality_issues:
        type: array
        items:
          type: string
        description: "List of observed quality issues (e.g., 'brown_spots', 'wilting')"
      grade:
        type: string
        enum: ["A", "B", "C", "D", "REJECT"]
        description: "Quality grade from QC analyzer"
      quality_score:
        type: number
        minimum: 0
        maximum: 100
        description: "Numeric quality score from QC analyzer"
      image_url:
        type: string
        format: uri
        description: "URL to quality issue image (optional)"
      farmer_context:
        type: object
        description: "Farmer context from plantation model"
        properties:
          region:
            type: string
            description: "Region identifier (e.g., 'Kericho-High')"
          altitude_band:
            type: string
            enum: ["low", "medium", "high"]
          recent_performance:
            type: object
            properties:
              quality_score_avg:
                type: number
              trend:
                type: string
                enum: ["improving", "stable", "declining"]
      weather_history:
        type: object
        description: "Weather data for lag correlation analysis"
        properties:
          last_7_days:
            type: object
            properties:
              rainfall_mm:
                type: number
              avg_humidity:
                type: number
              avg_temperature_c:
                type: number

# Output contract
output:
  event: "ai.agent.disease-diagnosis.completed"
  schema:
    type: object
    required:
      - diagnosis
      - recommendations
    properties:
      diagnosis:
        type: object
        required:
          - condition
          - confidence
          - severity
        properties:
          condition:
            type: string
            description: "Identified condition in snake_case (e.g., 'tea_blister_blight')"
          confidence:
            type: number
            minimum: 0
            maximum: 1
            description: "Diagnostic confidence (0.0-1.0)"
          severity:
            type: string
            enum: ["low", "moderate", "high", "critical"]
            description: "Severity level for action prioritization"
          details:
            type: string
            description: "Detailed explanation of diagnosis"
      recommendations:
        type: array
        items:
          type: string
        minItems: 1
        description: "Actionable recommendations for treatment"
      contributing_factors:
        type: array
        items:
          type: string
        description: "Factors that contributed to the condition"
      expected_recovery:
        type: string
        description: "Expected recovery timeframe with treatment"

# LLM configuration
llm:
  model: "anthropic/claude-3-5-sonnet"
  temperature: 0.3
  max_tokens: 2000

# RAG configuration (explorer-specific)
rag:
  enabled: true
  query_template: "tea plant disease symptoms: {{quality_issues}} conditions: {{weather_conditions}} region: {{region}}"
  knowledge_domains:
    - tea-disease
    - plant-pathology
  top_k: 5
  min_similarity: 0.7

# MCP sources for context fetching
mcp_sources:
  - server: plantation-mcp
    tools:
      - get_farmer
      - get_region
  - server: collection-mcp
    tools:
      - get_document

# Error handling
error_handling:
  max_attempts: 3
  backoff_ms: [100, 500, 2000]
  on_failure: publish_error_event
  dead_letter_topic: null

# Metadata
metadata:
  author: "dev-story-0.75.19"
  created_at: "2026-01-10T00:00:00Z"
  updated_at: "2026-01-10T00:00:00Z"
  git_commit: null
