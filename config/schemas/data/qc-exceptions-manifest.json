{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://farmerpower.io/schemas/data/qc-exceptions-manifest.json",
  "title": "QC Analyzer Exceptions - Payload Schema",
  "description": "Domain-specific schema for QC exception images payload. Used to validate the 'payload' section of the generic ZIP manifest.",
  "type": "object",
  "properties": {
    "grading_model_id": {
      "type": "string",
      "description": "Identifier of the ML model used for grading"
    },
    "grading_model_version": {
      "type": "string",
      "description": "Version of the grading model"
    },
    "total_exceptions": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of exception images in this batch"
    }
  },
  "definitions": {
    "document_attributes": {
      "title": "QC Exception Document Attributes",
      "description": "Schema for attributes in each document (from metadata files)",
      "type": "object",
      "properties": {
        "quality_grade": {
          "type": "string",
          "enum": ["A", "B", "C", "D", "F"],
          "description": "Quality grade assigned to this leaf"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Confidence score of the classification"
        },
        "leaf_type": {
          "type": "string",
          "enum": ["mature", "immature", "damaged", "unknown"],
          "description": "Type of leaf detected"
        },
        "defects": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of detected defects"
        },
        "requires_manual_review": {
          "type": "boolean",
          "description": "Whether this exception requires human review"
        }
      }
    },
    "linkage_fields": {
      "title": "QC Exception Linkage Fields",
      "description": "Expected linkage fields for cross-referencing",
      "type": "object",
      "required": ["plantation_id", "batch_id"],
      "properties": {
        "plantation_id": {
          "type": "string",
          "description": "Farmer/plantation identifier"
        },
        "batch_id": {
          "type": "string",
          "description": "Unique batch identifier"
        },
        "batch_result_ref": {
          "type": "string",
          "description": "Reference to the parent QC batch result document"
        },
        "factory_id": {
          "type": "string",
          "description": "Factory where grading occurred"
        }
      }
    }
  }
}
