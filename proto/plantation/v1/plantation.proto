// Plantation Model Service - gRPC API Definition
// Master data registry for the Farmer Power Platform

syntax = "proto3";

package farmer_power.plantation.v1;

import "google/protobuf/timestamp.proto";

// Note: Health checking uses standard grpc.health.v1.Health (grpc-health-checking package)
// No custom HealthService defined here to avoid duplication.

// ============================================================================
// Plantation Service - Core Operations
// ============================================================================

service PlantationService {
  // Region operations
  rpc GetRegion(GetRegionRequest) returns (Region);
  rpc ListRegions(ListRegionsRequest) returns (ListRegionsResponse);
  rpc CreateRegion(CreateRegionRequest) returns (Region);
  rpc UpdateRegion(UpdateRegionRequest) returns (Region);

  // Factory operations
  rpc GetFactory(GetFactoryRequest) returns (Factory);
  rpc ListFactories(ListFactoriesRequest) returns (ListFactoriesResponse);
  rpc CreateFactory(CreateFactoryRequest) returns (Factory);
  rpc UpdateFactory(UpdateFactoryRequest) returns (Factory);
  rpc DeleteFactory(DeleteFactoryRequest) returns (DeleteFactoryResponse);

  // Farmer operations
  rpc GetFarmer(GetFarmerRequest) returns (Farmer);
  rpc GetFarmerByPhone(GetFarmerByPhoneRequest) returns (Farmer);
  rpc ListFarmers(ListFarmersRequest) returns (ListFarmersResponse);
  rpc CreateFarmer(CreateFarmerRequest) returns (Farmer);
  rpc UpdateFarmer(UpdateFarmerRequest) returns (Farmer);

  // Collection Point operations
  rpc GetCollectionPoint(GetCollectionPointRequest) returns (CollectionPoint);
  rpc ListCollectionPoints(ListCollectionPointsRequest) returns (ListCollectionPointsResponse);
  rpc CreateCollectionPoint(CreateCollectionPointRequest) returns (CollectionPoint);
  rpc UpdateCollectionPoint(UpdateCollectionPointRequest) returns (CollectionPoint);
  rpc DeleteCollectionPoint(DeleteCollectionPointRequest) returns (DeleteCollectionPointResponse);

  // Performance summary operations
  rpc GetPerformanceSummary(GetPerformanceSummaryRequest) returns (PerformanceSummary);
}

// ============================================================================
// Common Types
// ============================================================================

message GeoLocation {
  double latitude = 1;
  double longitude = 2;
  double altitude_meters = 3;
}

message ContactInfo {
  string phone = 1;
  string email = 2;
  string address = 3;
}

// ============================================================================
// Region Messages
// ============================================================================

message Region {
  string id = 1;
  string name = 2;
  string code = 3;
  GeoLocation center = 4;
  string parent_region_id = 5;
  bool is_active = 6;
  google.protobuf.Timestamp created_at = 7;
  google.protobuf.Timestamp updated_at = 8;
}

message GetRegionRequest {
  string id = 1;
}

message ListRegionsRequest {
  int32 page_size = 1;
  string page_token = 2;
  string parent_region_id = 3;
  bool active_only = 4;
}

message ListRegionsResponse {
  repeated Region regions = 1;
  string next_page_token = 2;
  int32 total_count = 3;
}

message CreateRegionRequest {
  string name = 1;
  string code = 2;
  GeoLocation center = 3;
  string parent_region_id = 4;
}

message UpdateRegionRequest {
  string id = 1;
  optional string name = 2;
  optional string code = 3;
  optional GeoLocation center = 4;
  optional bool is_active = 5;
}

// ============================================================================
// Factory Messages
// ============================================================================

message Factory {
  string id = 1;
  string name = 2;
  string code = 3;
  string region_id = 4;
  GeoLocation location = 5;
  ContactInfo contact = 6;
  int32 processing_capacity_kg = 7;
  bool is_active = 8;
  google.protobuf.Timestamp created_at = 9;
  google.protobuf.Timestamp updated_at = 10;
}

message GetFactoryRequest {
  string id = 1;
}

message ListFactoriesRequest {
  int32 page_size = 1;
  string page_token = 2;
  string region_id = 3;
  bool active_only = 4;
}

message ListFactoriesResponse {
  repeated Factory factories = 1;
  string next_page_token = 2;
  int32 total_count = 3;
}

message CreateFactoryRequest {
  string name = 1;
  string code = 2;
  string region_id = 3;
  GeoLocation location = 4;
  ContactInfo contact = 5;
  int32 processing_capacity_kg = 6;
}

message UpdateFactoryRequest {
  string id = 1;
  optional string name = 2;
  optional string code = 3;
  optional GeoLocation location = 4;
  optional ContactInfo contact = 5;
  optional int32 processing_capacity_kg = 6;
  optional bool is_active = 7;
}

message DeleteFactoryRequest {
  string id = 1;
}

message DeleteFactoryResponse {
  bool success = 1;
}

// ============================================================================
// Collection Point Messages
// ============================================================================

message OperatingHours {
  string weekdays = 1;   // e.g., "06:00-10:00"
  string weekends = 2;   // e.g., "07:00-09:00"
}

message CollectionPointCapacity {
  int32 max_daily_kg = 1;
  string storage_type = 2;       // "covered_shed", "open_air", "refrigerated"
  bool has_weighing_scale = 3;
  bool has_qc_device = 4;
}

message CollectionPoint {
  string id = 1;                                    // Format: {region}-cp-XXX
  string name = 2;
  string factory_id = 3;
  GeoLocation location = 4;
  string region_id = 5;
  string clerk_id = 6;
  string clerk_phone = 7;
  OperatingHours operating_hours = 8;
  repeated string collection_days = 9;             // ["mon", "wed", "fri", "sat"]
  CollectionPointCapacity capacity = 10;
  string status = 11;                              // "active", "inactive", "seasonal"
  google.protobuf.Timestamp created_at = 12;
  google.protobuf.Timestamp updated_at = 13;
}

message GetCollectionPointRequest {
  string id = 1;
}

message ListCollectionPointsRequest {
  int32 page_size = 1;
  string page_token = 2;
  string factory_id = 3;
  string region_id = 4;
  string status = 5;
  bool active_only = 6;
}

message ListCollectionPointsResponse {
  repeated CollectionPoint collection_points = 1;
  string next_page_token = 2;
  int32 total_count = 3;
}

message CreateCollectionPointRequest {
  string name = 1;
  string factory_id = 2;
  GeoLocation location = 3;
  string region_id = 4;
  string clerk_id = 5;
  string clerk_phone = 6;
  OperatingHours operating_hours = 7;
  repeated string collection_days = 8;
  CollectionPointCapacity capacity = 9;
  string status = 10;
}

message UpdateCollectionPointRequest {
  string id = 1;
  optional string name = 2;
  optional string clerk_id = 3;
  optional string clerk_phone = 4;
  optional OperatingHours operating_hours = 5;
  repeated string collection_days = 6;
  optional CollectionPointCapacity capacity = 7;
  optional string status = 8;
}

message DeleteCollectionPointRequest {
  string id = 1;
}

message DeleteCollectionPointResponse {
  bool success = 1;
}

// ============================================================================
// Farmer Messages
// ============================================================================

// Farm scale classification based on hectares
enum FarmScale {
  FARM_SCALE_UNSPECIFIED = 0;
  FARM_SCALE_SMALLHOLDER = 1;   // < 1 hectare
  FARM_SCALE_MEDIUM = 2;        // 1-5 hectares
  FARM_SCALE_ESTATE = 3;        // > 5 hectares
}

message Farmer {
  string id = 1;                                    // Format: WM-XXXX (e.g., WM-0001)
  string grower_number = 2;                         // External/legacy ID if any
  string first_name = 3;
  string last_name = 4;
  string region_id = 5;                             // Auto-assigned based on GPS + altitude
  string collection_point_id = 6;                   // Primary registration collection point
  GeoLocation farm_location = 7;
  ContactInfo contact = 8;
  double farm_size_hectares = 9;
  FarmScale farm_scale = 10;                        // Auto-calculated from farm_size_hectares
  string national_id = 11;                          // Government ID
  google.protobuf.Timestamp registration_date = 12;
  bool is_active = 13;
  google.protobuf.Timestamp created_at = 14;
  google.protobuf.Timestamp updated_at = 15;
}

message GetFarmerRequest {
  string id = 1;
}

message GetFarmerByPhoneRequest {
  string phone = 1;
}

message ListFarmersRequest {
  int32 page_size = 1;
  string page_token = 2;
  string region_id = 3;
  string collection_point_id = 4;
  bool active_only = 5;
}

message ListFarmersResponse {
  repeated Farmer farmers = 1;
  string next_page_token = 2;
  int32 total_count = 3;
}

message CreateFarmerRequest {
  string first_name = 1;
  string last_name = 2;
  string collection_point_id = 3;                   // Primary registration collection point
  GeoLocation farm_location = 4;
  ContactInfo contact = 5;
  double farm_size_hectares = 6;
  string national_id = 7;                           // Government ID (required)
  string grower_number = 8;                         // External/legacy ID (optional)
}

message UpdateFarmerRequest {
  string id = 1;
  optional string first_name = 2;
  optional string last_name = 3;
  optional GeoLocation farm_location = 4;
  optional ContactInfo contact = 5;
  optional double farm_size_hectares = 6;
  optional bool is_active = 7;
}

// ============================================================================
// Performance Summary Messages
// ============================================================================

message PerformanceSummary {
  string id = 1;
  string entity_type = 2;  // "farmer", "factory", "region"
  string entity_id = 3;
  string period = 4;  // "daily", "weekly", "monthly", "yearly"
  google.protobuf.Timestamp period_start = 5;
  google.protobuf.Timestamp period_end = 6;

  // Aggregated metrics
  double total_green_leaf_kg = 7;
  double total_made_tea_kg = 8;
  int32 collection_count = 9;
  double average_quality_score = 10;

  google.protobuf.Timestamp created_at = 11;
  google.protobuf.Timestamp updated_at = 12;
}

message GetPerformanceSummaryRequest {
  string entity_type = 1;
  string entity_id = 2;
  string period = 3;
  google.protobuf.Timestamp period_start = 4;
}
